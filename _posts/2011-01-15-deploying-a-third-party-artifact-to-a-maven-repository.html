---
layout: post
status: publish
published: true
title: Deploying a third party artifact to a Maven Repository
author:
  display_name: Rob Petti
  login: rpetti
  email: rob.petti@gmail.com
  url: http://www.robpetti.com
author_login: rpetti
author_email: rob.petti@gmail.com
author_url: http://www.robpetti.com
excerpt: "Specifically, I'm attempting today to deploy the Perforce P4Java api to
  the Sonatype core Maven repository. Sonatype has plenty of documentation on this
  process, but most of them make the assumption that you are building the artifacts
  from source, and that you are already familiar with maven. I'm a maven newbie and
  I obviously don't have the source. Here's a quick rundown of how I did.\r\n"
wordpress_id: 68
wordpress_url: http://robpetti.com/?p=68
date: '2011-01-15 23:49:47 -0700'
date_gmt: '2011-01-16 04:49:47 -0700'
categories:
- Technical
tags: []
comments: []
---
<p>Specifically, I'm attempting today to deploy the Perforce P4Java api to the Sonatype core Maven repository. Sonatype has plenty of documentation on this process, but most of them make the assumption that you are building the artifacts from source, and that you are already familiar with maven. I'm a maven newbie and I obviously don't have the source. Here's a quick rundown of how I did.<br />
<a id="more"></a><a id="more-68"></a><br />
My primary resources was actually <a href="https:&#47;&#47;docs.sonatype.org&#47;display&#47;Repository&#47;How+To+Generate+PGP+Signatures+With+Maven">this<&#47;a> page (A shout out to Brian Jackson for pointing me in the right direction!)</p>
<p>The page mostly covers how to set up a gpg key, which is fairly straight forward and there's plenty of documentation on the internet on how to do it. But before we do anything, we need a working pom.xml. Here's the one I used:</p>
<pre class="brush: xml">
<project>
  <modelVersion>4.0.0<&#47;modelVersion><br />
  <groupId>com.perforce<&#47;groupId><br />
  <artifactId>p4java<&#47;artifactId></p>
<packaging>jar<&#47;packaging><br />
  <name>P4Java Api<&#47;name><br />
  <version>2010.1.269249<&#47;version><br />
  <description>Pure Java api for communicating with Perforce<&#47;description><br />
  <url>http:&#47;&#47;www.perforce.com<&#47;url><br />
  <developers><br />
    <developer><br />
      <id>perforce<&#47;id><br />
      <name>Perforce<&#47;name><br />
      <email>support@perforce.com<&#47;email><br />
    <&#47;developer><br />
  <&#47;developers></p>
<licenses>
<license>
      <name>Copyright (c) 2009, Perforce Software, Inc.  All rights reserved.<&#47;name><br />
      <url>LICENSE.txt<&#47;url><br />
      <distribution>repo<&#47;distribution><br />
    <&#47;license><br />
  <&#47;licenses><br />
  <scm><br />
   <url>http:&#47;&#47;www.perforce.com&#47;<&#47;url><br />
  <&#47;scm><br />
  <build></p>
<plugins>
<plugin>
        <groupId>org.apache.maven.plugins<&#47;groupId><br />
        <artifactId>maven-gpg-plugin<&#47;artifactId><br />
        <executions><br />
          <execution><br />
            <id>sign-artifacts<&#47;id></p>
<phase>verify<&#47;phase><br />
            <goals><br />
              <goal>sign<&#47;goal><br />
            <&#47;goals><br />
          <&#47;execution><br />
        <&#47;executions><br />
      <&#47;plugin><br />
    <&#47;plugins><br />
  <&#47;build><br />
<&#47;project><br />
<&#47;pre></p>
<p>I had to construct this from several examples in sonatype's documentation, as every example they gave was incomplete in one way or another. Once I was given access to com.perforce, I was able to upload to a staging repository, but first I needed to configure maven to authenticate against it. Here's my <code>~&#47;.m2&#47;settings.xml<&#47;code> file that accomplishes this authentication, since maven apparently isn't able to ask the user for credentials in the event they aren't available.</p>
<pre class="brush: xml">
<settings><br />
  <servers><br />
    <server><br />
      <id>sonatype-nexus-staging<&#47;id><br />
      <username>rpetti<&#47;username></p>
<password>************<&#47;password><br />
    <&#47;server><br />
  <&#47;servers><br />
<&#47;settings><br />
<&#47;pre></p>
<p>In my case, there were not one, but 3 different files that I needed to push to staging. The Sonatype documentation does not give any information about how to accomplish this, only the one snippet from the page above:</p>
<pre class="brush: plain">
$ mvn gpg:sign-and-deploy-file<br />
> -DpomFile=target&#47;myapp-1.0.pom<br />
> -Dfile=target&#47;myapp-1.0.jar<br />
> -Durl=https:&#47;&#47;oss.sonatype.org&#47;service&#47;local&#47;staging&#47;deploy&#47;maven2&#47;<br />
> -DrepositoryId=sonatype-nexus-staging<br />
<&#47;pre></p>
<p>Fortunately, we can work with this. Maven constructs artifact names in a very strict fashion: <code>${artifactId}-${version}-${classifier}.${packaging}<&#47;code>. We can override these properties directly on the command line, allowing for multiple artifacts with a single pom. I had to upload a license, a javadoc jar, and the jar library itself, so I ran the following:</p>
<pre class="brush: plain">
$ mvn gpg:sign-and-deploy-file<br />
> -DpomFile=pom.xml<br />
> -Dfile=p4java.jar<br />
> -Durl=https:&#47;&#47;oss.sonatype.org&#47;service&#47;local&#47;staging&#47;deploy&#47;maven2&#47;<br />
> -DrepositoryId=sonatype-nexus-staging</p>
<p>$ mvn gpg:sign-and-deploy-file<br />
> -DpomFile=pom.xml<br />
> -Dfile=LICENSE.txt<br />
> -Dclassifier=license<br />
> -Dpackaging=txt<br />
> -Durl=https:&#47;&#47;oss.sonatype.org&#47;service&#47;local&#47;staging&#47;deploy&#47;maven2&#47;<br />
> -DrepositoryId=sonatype-nexus-staging</p>
<p>$ mvn gpg:sign-and-deploy-file<br />
> -DpomFile=pom.xml<br />
> -Dfile=p4java-javadoc.jar<br />
> -Dclassifier=javadoc<br />
> -Dpackaging=jar<br />
> -Durl=https:&#47;&#47;oss.sonatype.org&#47;service&#47;local&#47;staging&#47;deploy&#47;maven2&#47;<br />
> -DrepositoryId=sonatype-nexus-staging<br />
<&#47;pre></p>
<p>This automatically created a staging repository in my <a href="https:&#47;&#47;oss.sonatype.org&#47;">sonatype oss<&#47;a> account for com.perforce. From there it's just a matter of verifying the files, closing it, and releasing.</p>
