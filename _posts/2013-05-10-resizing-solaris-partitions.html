---
layout: post
status: publish
published: true
title: Resizing Solaris Partitions
author:
  display_name: Rob Petti
  login: rpetti
  email: rob.petti@gmail.com
  url: http://www.robpetti.com
author_login: rpetti
author_email: rob.petti@gmail.com
author_url: http://www.robpetti.com
excerpt: "I'm currently in the process of resizing a partition in Solaris 10. So far,
  the instructions that I've found have been quite incorrect, so I'm documenting the
  steps I'm taking here. In my particular case, I'm resizing a single partition on
  a non-root disk after increasing it's size through VMWare.\r\n\r\n"
wordpress_id: 150
wordpress_url: http://robpetti.com/?p=150
date: '2013-05-10 15:12:14 -0600'
date_gmt: '2013-05-10 19:12:14 -0600'
categories:
- Technical
- Solaris
tags:
- resizing partitions
- solaris
comments:
- id: 2794
  author: Alex
  author_email: wikouk@ifs.co.uk
  author_url: ''
  date: '2013-10-24 11:10:19 -0600'
  date_gmt: '2013-10-24 15:10:19 -0600'
  content: "I did that on solaris 10, on VM and a second after \r\n# fdisk -S &#47;tmp&#47;geom
    -F &#47;tmp&#47;ptbl.tmp -I &#47;dev&#47;rdsk&#47;c1t1d0p0 (in my case)\r\nsolaris
    hang and my VM is unusable.\r\nI saw another post saying that ptbl.tmp should
    have Ecyl modified, in your case to 22191, which I cannot verify anyway as it
    is too late for me now."
---
<p>I'm currently in the process of resizing a partition in Solaris 10. So far, the instructions that I've found have been quite incorrect, so I'm documenting the steps I'm taking here. In my particular case, I'm resizing a single partition on a non-root disk after increasing it's size through VMWare.</p>
<p><a id="more"></a><a id="more-150"></a></p>
<p>Partitions in Solaris work quite a bit differently from partitions in other *nix platforms. First we have the partition. This is what we normally resize using utilities such as gparted. Within the Solaris partition, are slices. These can be thought of as 'sub partitions' that contain the filesystems to be mounted in the OS. In fact, Solaris often refers to slices as partitions, which can get a bit confusing at times. First we need to resize the overall Solaris partition, then resize the slice(s) within it.</p>
<p>It's worth noting that my case is exceptionally simple. I have a single filesystem, on a single slice, on a single partition, on a single disk separate from the root one. I don't recommend trying any of these steps on a root disk or root partition. Consider yourself warned.</p>
<p>First, we need to find out the device name:</p>
<pre class="code">
$ df -h &#47;disk1<br />
&#47;dev&#47;dsk&#47;c2t1d0s0      148G   112G    34G    77%    &#47;disk1<br />
<&#47;pre></p>
<p>Right now, we're interested not in the slice being mounted but the partition containing the slice. In this case it is c2t1d0p0. I'm sure there's some other way to figure this out, but in my case I only have one slice and one partition on this particular disk (c2t1d0), so it was easy to figure it out.</p>
<p>Unmount all slices:</p>
<pre class="code">
# umount &#47;disk1<br />
<&#47;pre></p>
<p>Dump the disk geometry:</p>
<pre class="code">
# fdisk -G &#47;dev&#47;rdsk&#47;c2t1d0p0 > &#47;tmp&#47;geom<br />
<&#47;pre></p>
<p>Then dump the current partition table:</p>
<pre class="code">
# fdisk -W &#47;tmp&#47;ptbl.tmp &#47;dev&#47;rdsk&#47;c2t1d0p0<br />
<&#47;pre></p>
<p>I recommend backing up the partition table at this point, in case you need it later.</p>
<p>Also, you will want to record the current slice map. Solaris has a command to help you do this, but it refers to slices as 'partitions'. These partitions are actually slices in the Solaris partition that (should) encompass the entire disk, and are not to be confused with the disk's partition table that you will modify using fdisk. You can print the current slices using the <code>format<&#47;code> command, selecting your disk, and printing the partition map ('p' from the partition menu). It should look something like this:</p>
<pre class="code">
Part      Tag    Flag     Cylinders         Size            Blocks<br />
  0 unassigned    wm       1 - 19577      149.97GB    (19577&#47;0&#47;0) 314504505<br />
  1 unassigned    wm       0                0         (0&#47;0&#47;0)             0<br />
  2     backup    wu       0 - 19577      149.98GB    (19578&#47;0&#47;0) 314520570<br />
  3 unassigned    wm       0                0         (0&#47;0&#47;0)             0<br />
  4 unassigned    wm       0                0         (0&#47;0&#47;0)             0<br />
  5 unassigned    wm       0                0         (0&#47;0&#47;0)             0<br />
  6 unassigned    wm       0                0         (0&#47;0&#47;0)             0<br />
  7 unassigned    wm       0                0         (0&#47;0&#47;0)             0<br />
  8       boot    wu       0 -     0        7.84MB    (1&#47;0&#47;0)         16065<br />
  9 unassigned    wm       0                0         (0&#47;0&#47;0)             0<br />
<&#47;pre></p>
<p>Keep this somewhere safe for referencing later.</p>
<p>Edit the ptbl.tmp file you created. At the top, you'll see your disks geometry. At the bottom is the layout. The ONLY field you are interested in modifying at the bottom is the number of sectors (Numsect).</p>
<pre class="code">
* &#47;dev&#47;rdsk&#47;c2t1d0p0 default fdisk table<br />
* Dimensions:<br />
*    512 bytes&#47;sector<br />
*     63 sectors&#47;track<br />
*    255 tracks&#47;cylinder<br />
*   22192 cylinders<br />
* Id    Act  Bhead  Bsect  Bcyl    Ehead  Esect  Ecyl    Rsect    Numsect<br />
  191   128  0      1      1       254    63     1023    16065    314552700<br />
<&#47;pre></p>
<p>In my case, I needed to expand the partition to fill the entire disk. I did this by taking the number of cylinders, subtracting one (since the partition starts at cylinder one and not 0 (Bcyl)), multiplying that number by tracks&#47;cylinder, and multiplying that by sectors&#47;track. So the new Numsect value is: 22191*255*63 = 356498415.</p>
<p>Once that's been changed, write the new partition table to disk:</p>
<pre class="code">
# fdisk -S &#47;tmp&#47;geom -F &#47;tmp&#47;ptbl.tmp -I &#47;dev&#47;rdsk&#47;c2t1d0p0<br />
<&#47;pre></p>
<p>You can run fdisk normally (<code>fdisk &#47;dev&#47;rdsk&#47;c2t1d0p0<&#47;code>) in order to verify your changes. Once that is done, run <code>format<&#47;code> again, since the solaris partition (slices) map may have been lost. In my case, slice 0 lost it's information, so I recreated it to start at the same start cylinder as before (1), and take up the rest of the disk. Modify it using '0' from the partition menu, and save the new map using the 'label' command from within the partition menu.</p>
<pre class="code">
Part      Tag    Flag     Cylinders         Size            Blocks<br />
  0 unassigned    wm       1 - 22188      169.97GB    (22188&#47;0&#47;0) 356450220<br />
  1 unassigned    wm       0                0         (0&#47;0&#47;0)             0<br />
  2     backup    wu       0 - 22188      169.98GB    (22189&#47;0&#47;0) 356466285<br />
  3 unassigned    wm       0                0         (0&#47;0&#47;0)             0<br />
  4 unassigned    wm       0                0         (0&#47;0&#47;0)             0<br />
  5 unassigned    wm       0                0         (0&#47;0&#47;0)             0<br />
  6 unassigned    wm       0                0         (0&#47;0&#47;0)             0<br />
  7 unassigned    wm       0                0         (0&#47;0&#47;0)             0<br />
  8       boot    wu       0 -     0        7.84MB    (1&#47;0&#47;0)         16065<br />
  9 unassigned    wm       0                0         (0&#47;0&#47;0)             0<br />
<&#47;pre></p>
<p>The slice should now have been resized. Next is to verify that no data was lost:</p>
<pre class="code">
# fsck &#47;dev&#47;rdsk&#47;c2t1d0s0<br />
<&#47;pre></p>
<p>And finally, grow the filesystem to take up the rest of the slice:</p>
<pre class="code">
# growfs &#47;dev&#47;rdsk&#47;c2t1d0s0<br />
<&#47;pre></p>
<p>And that's it! Hopefully this helps people understand Solaris partitioning schemes a little bit better. I learned quite a bit while figuring this out.</p>
