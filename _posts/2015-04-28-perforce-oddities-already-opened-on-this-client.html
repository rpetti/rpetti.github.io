---
layout: post
status: publish
published: true
title: 'Perforce Oddities: "already opened on this client"'
author:
  display_name: Rob Petti
  login: rpetti
  email: rob.petti@gmail.com
  url: http://www.robpetti.com
author_login: rpetti
author_email: rob.petti@gmail.com
author_url: http://www.robpetti.com
wordpress_id: 179
wordpress_url: http://robpetti.com/?p=179
date: '2015-04-28 13:11:41 -0600'
date_gmt: '2015-04-28 17:11:41 -0600'
categories:
- Technical
- Perforce
tags:
- perforce
comments: []
---
<p>One of my users recently ran into a situation in which they couldn't open a file for editing because perforce thought the file was already opened on their client:</p>
<pre name="code" class="brush: bash">
$ p4 edit <somefile><br />
<somefile> - can't edit (already opened on this client)<br />
<&#47;pre><br />
The bizzare thing is was that <code>p4 opened -a -u <user><&#47;code> did not show this file, and the user wasn't able to revert it either. Running <code>p4 fstat<&#47;code> on the file, however, did show that the file was open on that client:</p>
<pre name="code" class="brush: bash">
$ p4 fstat <file><br />
...<br />
... haveRev 1<br />
... ... otherOpen0 <user>@<client><br />
... ... otherAction0 edit<br />
... ... otherChange0 default<br />
... ... otherOpen 1<br />
<&#47;pre></p>
<p>Perforce support informed me that the issue was due to an inconsistency between database tables db.working and db.locks. <code>p4d -xx<&#47;code> doesn't seem to check for this, so you need to use another p4d command: <code>p4d -xf 925<&#47;code></p>
<p>This can be run on a live master server without any issues. It ran very quickly in my case, and even wrote the changes to the journal so replicas will be able to pick them up without any manual intervention:</p>
<pre name="code" class="brush: bash">
$ p4d -r <P4ROOT> -xf 925<br />
<&#47;pre></p>
